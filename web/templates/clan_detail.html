{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="card-header">
    <div>
      <p class="eyebrow">Clan</p>
      <h2>{{ clan.name }}</h2>
      <p class="lede">Manage roster and members for {{ clan.slug }}.</p>
    </div>
    <div class="pill">Members: {{ members|length }}</div>
  </div>

  <form method="post" action="/clans/add-member" class="form inline">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="clan_id" value="{{ clan.id }}">
    <label>RSN
      <input type="text" name="account_name" required placeholder="Add member RSN">
    </label>
    <label>Mode
      <select name="mode">
        {% for mode in modes %}
          <option value="{{ mode }}">{{ 'Auto-detect' if mode == 'auto' else mode }}</option>
        {% endfor %}
      </select>
    </label>
    <div class="form-actions">
      <button class="btn primary" type="submit">Add member</button>
    </div>
  </form>
</section>

<section class="card">
  <h3>Members</h3>
  {% if members %}
    <div class="list">
      {% for m in members %}
        <div class="list-row">
          <div>
            <div class="list-title">{{ m.name }}</div>
            <div class="list-sub">Mode: {{ m.default_mode or 'main' }}</div>
          </div>
          <div class="list-actions">
            <a class="btn ghost small" href="/profiles">View account</a>
            <form method="post" action="/clans/remove-member">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <input type="hidden" name="clan_id" value="{{ clan.id }}">
              <input type="hidden" name="account_id" value="{{ m.account_id }}">
              <button class="btn ghost small" type="submit">Remove</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="ink-2">No members yet.</p>
  {% endif %}
</section>

<section class="card">
  <div class="card-header">
    <div>
      <p class="eyebrow">Scheduling</p>
      <h3>Clan snapshot cadence</h3>
    </div>
  </div>
  <form class="form inline" hx-post="/jobs/schedule/clan" hx-target="#job-schedules" hx-swap="innerHTML">
    <input type="hidden" name="clan_id" value="{{ clan.id }}">
    <label>Frequency
      <select name="cron" required>
        <option value="0 * * * *">Every hour</option>
        <option value="0 */6 * * *" selected>Every 6 hours</option>
        <option value="0 0 * * *">Daily (00:00 UTC)</option>
        <option value="0 6 * * *">Daily (06:00 UTC)</option>
        <option value="0 0 * * 0">Weekly (Sun 00:00 UTC)</option>
        <option value="0 6 * * 1">Weekly (Mon 06:00 UTC)</option>
        <option value="custom">Custom cronâ€¦</option>
      </select>
    </label>
    <label>Custom (advanced)
      <input type="text" name="custom_cron" placeholder="0 */6 * * *">
    </label>
    <button class="btn primary" type="submit">Add schedule</button>
  </form>
  <div id="job-schedules" hx-get="/jobs/schedule/list" hx-trigger="load, every 60s" hx-swap="innerHTML" hx-headers='{"HX-Request":"true"}'></div>
</section>

<section class="card">
  <div class="card-header">
    <div>
      <p class="eyebrow">Webhooks</p>
      <h3>Clan webhooks</h3>
    </div>
  </div>
  <form class="form inline" hx-post="/webhooks/clan" hx-target="#webhooks-panel" hx-swap="innerHTML">
    <input type="hidden" name="clan_id" value="{{ clan.id }}">
    <label>URL
      <input type="url" name="url" placeholder="https://discord.com/api/webhooks/..." required>
    </label>
    <label>Events
      <select name="events">
        <option value="snapshot_complete" selected>snapshot_complete</option>
      </select>
    </label>
    <label>Provider
      <select name="provider">
        <option value="discord" selected>Discord</option>
        <option value="slack">Slack</option>
        <option value="custom">Custom</option>
      </select>
    </label>
    <button class="btn primary" type="submit">Save webhook</button>
  </form>
  <div id="webhooks-panel" hx-get="/webhooks" hx-trigger="load, every 5m" hx-swap="innerHTML" hx-headers='{"HX-Request":"true"}'></div>
</section>
{% endblock %}
