<div class="list">
  {% for snap in snapshots %}
    {% set is_latest = (page == 1 and loop.first) %}
    <div class="list-row"
         hx-get="/profiles/{{ rsn }}/snapshot_detail?snapshot_id={{ snap.snapshot_id }}&view=panel&is_latest={{ 1 if is_latest else 0 }}"
         hx-target="#snapshot-content"
         hx-swap="innerHTML"
         hx-indicator="#snapshot-indicator"
         style="cursor:pointer;">
      <div>
        <div class="list-title">{{ snap.fetched_at_display or snap.fetched_at }}</div>
        <div class="list-sub">
          Mode: {{ snap.resolved_mode }}
          · Total LVL {{ snap.total_level }}
          · XP {{ snap.total_xp }}
          {% if snap.delta_summary %}· {{ snap.delta_summary }}{% endif %}
        </div>
      </div>
      <div class="list-actions">
        {% if snap.snapshot_id %}
          <button class="btn ghost small"
                  hx-trigger="click consume"
                  hx-get="/profiles/{{ rsn }}/snapshot_detail?snapshot_id={{ snap.snapshot_id }}&view=report"
                  hx-target="#snapshot-content"
                  hx-swap="innerHTML"
                  data-copy-report="/api/snapshots/{{ snap.snapshot_id }}/report"
                  onclick="window.snapshotCopyMode && window.snapshotCopyMode('report', this)">Report</button>
          <button class="btn ghost small"
                  hx-trigger="click consume"
                  hx-get="/profiles/{{ rsn }}/snapshot_detail?snapshot_id={{ snap.snapshot_id }}&view=json"
                  hx-target="#snapshot-content"
                  hx-swap="innerHTML"
                  data-copy-json="/api/snapshots/{{ snap.snapshot_id }}/raw"
                  onclick="window.snapshotCopyMode && window.snapshotCopyMode('json', this)">JSON</button>
          <button class="btn ghost small danger"
                  hx-trigger="click consume"
                  hx-delete="/profiles/{{ rsn }}/snapshot?snapshot_id={{ snap.snapshot_id }}&page={{ page }}&page_size={{ page_size }}"
                  hx-target="#timeline"
                  hx-swap="innerHTML"
                  hx-confirm="Delete this snapshot?"
                  hx-vals='{"deleted_snapshot_id": "{{ snap.snapshot_id }}"}'>Delete</button>
        {% endif %}
      </div>
    </div>
  {% endfor %}
  {% if not snapshots %}
    <p class="ink-2">No snapshots yet. Run one above.</p>
  {% endif %}
</div>

{% if refresh_snapshot_id %}
  <div hx-get="/profiles/{{ rsn }}/snapshot_detail?snapshot_id={{ refresh_snapshot_id }}&view=panel"
       hx-trigger="load"
       hx-swap="none"></div>
{% endif %}

{% if total > page_size %}
<div class="pagination">
    {% set total_pages = (total // page_size) + (1 if total % page_size else 0) %}
    <span class="ink-2">Page {{ page }} / {{ total_pages }}</span>
    <div>
      {% if page > 1 %}
        <button class="btn ghost small" hx-get="/profiles/{{ rsn }}/timeline?page={{ page - 1 }}&page_size={{ page_size }}" hx-target="#timeline" hx-swap="innerHTML">Prev</button>
      {% endif %}
      {% if page * page_size < total %}
        <button class="btn ghost small" hx-get="/profiles/{{ rsn }}/timeline?page={{ page + 1 }}&page_size={{ page_size }}" hx-target="#timeline" hx-swap="innerHTML">Next</button>
      {% endif %}
    </div>
  </div>
{% endif %}
